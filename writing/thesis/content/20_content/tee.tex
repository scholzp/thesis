\section{Trusted Execution Environments}
\label{sec:state:tee}
% \begin{figure}
%     \begin{tikzpicture}
%         \draw (1,0) -- (0,0) -- (0,1) -- cycle;
%     \end{tikzpicture}
%     \caption{Tikz test}
% \end{figure}

Suppose we are the developers of the messenger Signal. While we aim to implement a mechanism for automatic contact
discovery, we also want to follow our claims to ensure the privacy of communication for our users. This is because we do not
want to learn who is communicating with whom, nor do we want to learn about the communication itself.

While we could encrypt our users' phonebooks before uploading them to our servers for processing, encryption
alone is not enough to fulfill our privacy claims. For example, through encryption alone, the user is not able to
verify that they are communicating with a Signal server. While this problem could be solved with cryptographic
signatures, the user is still not able to verify that the server application is the expected one. For example, if
the Signal Foundation was malicious, it could install an application designed to spy on the communication. In another
scenario, the Signal server application could fall victim to malicious privileged entities.
Maintenance personnel with access to the server hardware could tap the memory bus. Privileged software, such as operating
systems or hypervisors, could manipulate the memory of the server application in a way that leaks information or
simply reads the memory containing all secrets. It is, therefore, necessary to protect not only the communication channels
between user and server but also the integrity and confidentiality of the server application. Moreover, the user should
be able to verify these claims on the server application.

The latter is the goal of remote attestation, a feature offered by many Trusted Execution Environments to verify that
software is executed as intended and that no information leak is possible. For TEEs to work, a system must contain a
so-called hardware root of trust. A hardware root of trust is a device that is self-protecting on the hardware level,
unable to be
modified even by privileged software, and often implementing cryptographic functions. Different solutions exist to
implement the functionality of Trusted Execution Environments. The following section will give us an overview of these
solutions.

\todo{Explain measurements, how the majority implements RA}

\subsection{Hardware Root of Trust}
\subsubsection{TPM}

\subsubsection{Intel SGX}
Intel SGX is an extension in some x86\_64 processors manufactured by Intel. SGX was first shipped in 2015 with Intel
processors implementing the Skylake micro architecture. While server grade CPUs are still implementing SGX, Intel marked
SGX as deprecated in 2021 in consumer grade CPUs beginning from CPUs implementing the Rocket Lake micro architecture. An
extensive review of SGX was done by Costan et. al. in 2016.\cite{costan2016intel}

Features of SGX include the creation of so called enclaves. Enclaves are specially access protected and encrypted
regions of system memory with SGX even preventing direct memory access. In the creation process, memory pages are
added to the so called enclave page cache (EPC) and assigned to the enclave. Once assigned to an enclave, SGX protect
the memory page from unprivileged access, which includes all access attempts not originating from the memory owning
enclave. After all pages have been added to the enclave, the enclave is marked as initialized. The whole initialization
process is done by system software, which is either the operating system or the hypervisor, by using privileged
instructions. After the enclave is marked initialized, no more pages can be added to the EPC and interaction with the
enclave is only allowed by using dedicated instructions available only in user space. Enclave code runs with the
permission level of the application from which the enclave was called. Data and code added to the EPC are encrypted
using keys burned into the CPU hardware via e-fuses.

As already mentioned, SGX implements processor instructions dedicated to manage and interact with enclaves. Furthermore,
SGX implementations create at least a so called Launch Enclave that is signed by Intel. The Launch Enclave is a
requirement for the successful initialization of enclaves not provided by Intel. To implement software attestation,
SGX uses a second enclave provided by Intel, the so called Quoting Enclave.

\subsubsection{Confidential VM Extensions}
\subsubsection{ARM TrustZone}
